# -*- coding: utf-8 -*-
#                     The LLVM Compiler Infrastructure
#
# This file is distributed under the University of Illinois Open Source
# License. See LICENSE.TXT for details.

import os
import os.path
import lit.util

# test_source_root: The root path where tests are located.
this_dir = os.path.dirname(__file__)
tool_dir = os.path.join(this_dir, 'tools')

config.environment['test_input_dir'] = os.path.join(this_dir, 'Input')

config.environment['CC'] = 'clang'
config.environment['CXX'] = 'clang++'

# use binaries from $PATH or bin_dir (does not require package install).
if lit_config.params.get('BINARIES') != 'PATH':
    bin_dir = os.path.join(this_dir, 'bin')
    parent_dir = os.path.dirname(this_dir)
    project_dir = os.path.dirname(parent_dir)

    config.environment['PATH'] = os.pathsep.join([bin_dir, os.environ['PATH']])
    config.environment['PYTHONPATH'] = project_dir

# this hack is needed to run the right compiler on travis-ci
clang=os.environ.get('TRAVIS_CLANG', 'clang')

config.substitutions.append(
    ('%{analyze-build}',
     'analyze-build --use-analyzer={clang} -vvvv'.format(clang=clang)))
config.substitutions.append(
    ('%{scan-build}',
     'scan-build --use-analyzer={clang} -vvvv'.format(clang=clang)))
config.substitutions.append(
    ('%{intercept-build}',
     'intercept-build  -vvvv'))
config.substitutions.append(
    ('%{cdb_diff}',
    '{python} {diff}'.format(python=sys.executable, diff=os.path.join(tool_dir, 'diff.py'))))
config.substitutions.append(
    ('%{expect}',
    '{python} {expect}'.format(python=sys.executable, expect=os.path.join(tool_dir, 'expect.py'))))
